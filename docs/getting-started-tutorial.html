<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.8.dev">
<title>How to Build a Chat Room in Codename One</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>How to Build a Chat Room in Codename One</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#trueabout-the-chatroomview-component">About the ChatRoomView Component</a></li>
<li><a href="#trueprerequisites">Prerequisites</a></li>
<li><a href="#trueproject-setup">Project Setup</a>
<ul class="sectlevel2">
<li><a href="#truestep-1-create-a-new-codename-one-project">Step 1:  Create a New Codename One project</a></li>
<li><a href="#truestep-2-activate-css">Step 2: Activate CSS</a></li>
<li><a href="#truestep-3-add-dependencies">Step 3: Add Dependencies</a></li>
<li><a href="#truestep-4-create-application-controller">Step 4: Create Application Controller</a></li>
<li><a href="#truestep-5-create-a-form-controller">Step 5: Create A Form Controller</a></li>
<li><a href="#truestep-6-show-the-form">Step 6: Show the Form</a></li>
<li><a href="#truestep-7-run-the-app">Step 7: Run the App</a></li>
</ul>
</li>
<li><a href="#trueadding-a-send-button">Adding a "Send" Button</a>
<ul class="sectlevel2">
<li><a href="#truehandling-the-send-action-event">Handling the "Send" Action Event</a></li>
<li><a href="#truebonus-points-disable-send-button-when-input-empty">Bonus Points: Disable Send Button When Input Empty</a></li>
</ul>
</li>
<li><a href="#trueadding-text-messages-from-other-users">Adding Text Messages from Other Users</a></li>
<li><a href="#trueadding-the-participants-title-component">Adding the "Participants" Title Component</a>
<ul class="sectlevel2">
<li><a href="#truesidebar-getting-and-setting-properties-on-entities">Sidebar: Getting and Setting Properties on Entities</a></li>
<li><a href="#truefinally-adding-the-participants">Finally&#8230;&#8203; Adding the Participants</a></li>
</ul>
</li>
<li><a href="#trueadding-more-actions">Adding More Actions</a>
<ul class="sectlevel2">
<li><a href="#trueadding-phone-and-video-conferencing">Adding Phone and Video Conferencing</a></li>
<li><a href="#trueadding-a-like-badge">Adding a "Like" Badge</a></li>
</ul>
</li>
<li><a href="#trueadding-a-photo-capture-feature">Adding A Photo Capture Feature</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This tutorial describes how to use the RADChatRoom library to quickly and easily add a nice-looking, fully functional chat room to your Codename One application.</p>
</div>
<div class="paragraph">
<p>The finished product will look like the following:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-105119.095.png" alt="ChatRoomView screenshot">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueabout-the-chatroomview-component"><a class="anchor" href="#trueabout-the-chatroomview-component"></a>About the ChatRoomView Component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The ChatRoomView component is the first in a new breed of Codename One UI components which go beyond the the fundamental building blocks of user interfaces to provide a rich, fully-functional user experience out of the box.  It is built on top of the new CodeRAD library which enables a new level of code-reuse based on the tried-and-true MVC (Model-View-Controller) design pattern.  As you&#8217;ll see, adding a chat feature to your app is not difficult.  All of the minutiae of UI details come working and ready to go.  You just need to bind it to your view model and controller.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueprerequisites"><a class="anchor" href="#trueprerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to create the project in this tutorial, you&#8217;ll need the following:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>IntelliJ, NetBeans, or Eclipse with the Codename One plugin installed.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>For information about installing Codename One, see <a href="https://www.codenameone.com/download.html">this page</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueproject-setup"><a class="anchor" href="#trueproject-setup"></a>Project Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this tutorial, we&#8217;ll create a basic Codename One project, and we&#8217;ll add the "CodeRAD" and "RADChatRoom" cn1libs as dependencies.  I&#8217;ll use NetBeans in this tutorial, but you can use your preferred IDE (IntelliJ or Eclipse).</p>
</div>
<div class="paragraph">
<p>For the sake of this tutorial, I&#8217;m going to name the project CN1Chat, and my package will be "com.codename1.cn1chat".  I&#8217;ll be using the "Hello World" bare-bones project template.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-113718.350.png" alt="Create new project in NetBeans">
</div>
<div class="title">Figure 1. New project dialog in NetBeans.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-113809.644.png" alt="Create new project in NetBeans wizard page 2">
</div>
<div class="title">Figure 2. Page 2 of new project wizard in NetBeans</div>
</div>
<div class="sect2">
<h3 id="truestep-1-create-a-new-codename-one-project"><a class="anchor" href="#truestep-1-create-a-new-codename-one-project"></a>Step 1:  Create a New Codename One project</h3>
<div class="paragraph">
<p>If you haven&#8217;t created a Codename One project before, you can refer to <a href="https://www.codenameone.com/hello-world.html">this tutorial</a>, which walks you through the creation of your first Codename One project.</p>
</div>
</div>
<div class="sect2">
<h3 id="truestep-2-activate-css"><a class="anchor" href="#truestep-2-activate-css"></a>Step 2: Activate CSS</h3>
<div class="paragraph">
<p>The CodeRAD and RADChatRoom libs require CSS to be activated in your project.  See <a href="https://www.codenameone.com/blog/live-css-update.html">this tutorial</a> for the steps on enabling CSS.</p>
</div>
</div>
<div class="sect2">
<h3 id="truestep-3-add-dependencies"><a class="anchor" href="#truestep-3-add-dependencies"></a>Step 3: Add Dependencies</h3>
<div class="paragraph">
<p>In Codename One settings, add the following cn1libs:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>CodeRAD</p>
</li>
<li>
<p>RADChatRoom</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>If you haven&#8217;t activated any cn1libs before in your Codename One projects, see <a href="https://www.codenameone.com/blog/automatically-install-update-distribute-cn1libs-extensions.html">this tutorial</a> which explains the process.</p>
</div>
</div>
<div class="sect2">
<h3 id="truestep-4-create-application-controller"><a class="anchor" href="#truestep-4-create-application-controller"></a>Step 4: Create Application Controller</h3>
<div class="paragraph">
<p>We&#8217;ll be using MVC for this app.  The CodeRAD cn1lib includes a set of controller classes that help with the structure of such apps.  We&#8217;ll begin by modifying our app&#8217;s main application class (CN1Chat.java) so that it extends <code>ApplicationController</code>, and we&#8217;ll replace the class contents with the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;


import com.codename1.rad.controllers.ApplicationController;
import com.codename1.rad.controllers.ControllerEvent;

public class CN1Chat extends ApplicationController {
     @Override
    public void actionPerformed(ControllerEvent evt) {
        if (evt instanceof StartEvent) {
            evt.consume();

            // The app has started
        }
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truestep-5-create-a-form-controller"><a class="anchor" href="#truestep-5-create-a-form-controller"></a>Step 5: Create A Form Controller</h3>
<div class="paragraph">
<p>Next we&#8217;ll create a controller for the form that will contain the chat. This will create a basic view model, and use it to create a ChatRoomView object, which we will add to the form.  The code for the first iteration of this controller is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;

// imports


public class ChatFormController extends FormController {

    public ChatFormController(Controller parent) {
        super(parent);
        Form f = new Form("My First Chat Room", new BorderLayout());
        ChatRoomView view = new ChatRoomView(createViewModel(), f);
        f.add(CENTER, view);
        setView(f);
    }

    /**
     * Creates a view model for the chat room.
     * @return
     */
    private Entity createViewModel() {
        ChatRoomView.ViewModel room = new ChatRoomView.ViewModel();

        ChatBubbleView.ViewModel message = new ChatBubbleView.ViewModel();
        message.messageText("Hello World");
        room.addMessages(message);
        return room;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>A couple of things to note with this code:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The <code>createViewModel()</code> method creates a minimal view model for our chat room. It uses the <code>ChatRoomView.ViewModel</code> class for the view model.  This class is only a reference implementation of a view model, and the <code>ChatRoomView</code> class doesn&#8217;t require you to use this class at all if you don&#8217;t want to.  Later on, in this tutorial, I&#8217;ll show you how to use your own custom class for the view model.</p>
</li>
<li>
<p>Similarly, the <code>ChatBubbleView.ViewModel</code> is a reference implementation of a view model to encapsulate a message in the chat room, but you can use your own custom classes for these models also.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="truestep-6-show-the-form"><a class="anchor" href="#truestep-6-show-the-form"></a>Step 6: Show the Form</h3>
<div class="paragraph">
<p>Finally, we need to show the Chat form when the app launches. Modify your Application controller class to create a new instance of ChatFormController() and show its form as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class CN1Chat extends ApplicationController {
     @Override
    public void actionPerformed(ControllerEvent evt) {
        if (evt instanceof StartEvent) {
            evt.consume();
            new ChatFormController(this).getView().show();
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truestep-7-run-the-app"><a class="anchor" href="#truestep-7-run-the-app"></a>Step 7: Run the App</h3>
<div class="paragraph">
<p>Now that we have the minimal foundation in place, let&#8217;s run the app in the simulator.  If everything goes well, you should see something like the following.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-020614.790.png" alt="Running basic app in simulator">
</div>
<div class="title">Figure 3. First run of Chat app in simulator.</div>
</div>
<div class="paragraph">
<p>This looks good, but it&#8217;s not a fully functional chat app yet.  You&#8217;ll notice that it is missing many of the features that are present in the screenshot I shared of the finished project. The finished project included a title component with avatars of the chat participants:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-020916.612.png" alt="Chat participants title bar">
</div>
<div class="title">Figure 4. Chat participants listed in title bar in finished version of the app.</div>
</div>
<div class="paragraph">
<p>This is absent because we didn&#8217;t add any participants to the chat model.</p>
</div>
<div class="paragraph">
<p>In addition, there is no "Send" button, in this version, so there is no apparent way to send messages in this chat.</p>
</div>
<div class="paragraph">
<p>We&#8217;ll correct both of these omissions, and add some other features over the course of this tutorial.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-a-send-button"><a class="anchor" href="#trueadding-a-send-button"></a>Adding a "Send" Button</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A "Send" button is a pretty important part of any chat application.  We&#8217;ll add a send button to our app by defining an action in our controller, and passing it to the ChatRoomView as follows.  First we&#8217;ll define the action in our ChatFormController class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// We're going to use a lot of static functions from the UI class for creating
// UI elements like actions declaratively, so we'll do a static import here.
import static com.codename1.rad.ui.UI.*;

// ...
public class ChatFormController extends FormController {

    // Define the "SEND" action for the chat room
    public static final ActionNode send = action(icon(FontImage.MATERIAL_SEND));</code></pre>
</div>
</div>
<div class="paragraph">
<p>Then we&#8217;ll create a ViewNode to pass to the ChatRoomView constructor.  This is can contain properties that the chat room uses to render itself, including which actions it should "embed" and where.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">ViewNode viewNode = new ViewNode(
    actions(ChatRoomView.SEND_ACTION, send)
);

ChatRoomView view = new ChatRoomView(createViewModel(), viewNode, f);</code></pre>
</div>
</div>
<div class="paragraph">
<p>If this is the first time you&#8217;ve seen a ViewNode definition, this may look a little bit foreign.  All this does is register our "send" action with the "ChatRoomView.SEND_ACTION" category so that the chat room view knows to use it as the "send" action in the chat room.  The full source of the ChatRoomController class after these changes is as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;

import com.codename1.rad.controllers.Controller;
import com.codename1.rad.controllers.FormController;
import com.codename1.rad.models.Entity;
import com.codename1.rad.nodes.ActionNode;
import com.codename1.rad.nodes.ViewNode;
import com.codename1.rad.ui.chatroom.ChatBubbleView;
import com.codename1.rad.ui.chatroom.ChatRoomView;
import static com.codename1.ui.CN.CENTER;
import com.codename1.ui.FontImage;
import com.codename1.ui.Form;
import com.codename1.ui.layouts.BorderLayout;

// We're going to use a lot of static functions from the UI class for creating
// UI elements like actions declaratively, so we'll do a static import here.
import static com.codename1.rad.ui.UI.*;


public class ChatFormController extends FormController {

    // Define the "SEND" action for the chat room
    public static final ActionNode send = action(icon(FontImage.MATERIAL_SEND));

    public ChatFormController(Controller parent) {
        super(parent);
        Form f = new Form("My First Chat Room", new BorderLayout());

        // Create a "view node" as a UI descriptor for the chat room.
        // This allows us to customize and extend the chat room.
        ViewNode viewNode = new ViewNode(
            actions(ChatRoomView.SEND_ACTION, send)
        );

        // Add the viewNode as the 2nd parameter
        ChatRoomView view = new ChatRoomView(createViewModel(), viewNode, f);
        f.add(CENTER, view);
        setView(f);


    }

    /**
     * Creates a view model for the chat room.
     * @return
     */
    private Entity createViewModel() {
        ChatRoomView.ViewModel room = new ChatRoomView.ViewModel();

        ChatBubbleView.ViewModel message = new ChatBubbleView.ViewModel();
        message.messageText("Hello World");
        room.addMessages(message);
        return room;
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s run the app in the simulator again.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-023413.437.png" alt="ChatRoom after adding the send action">
</div>
</div>
<div class="paragraph">
<p>Notice that a "send" button has been added to the bototm-right of the form, next to the text entry box.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-023537.351.png" alt="Send button and chat entry box">
</div>
</div>
<div class="paragraph">
<p>This is progress, but you may be disappointed, upon playing with the send button, to discover that it doesn&#8217;t do anything.  In fact, when you click the "send" button, the view is sending an event to our controller.  We just haven&#8217;t implemented a handler for it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s do that now.</p>
</div>
<div class="sect2">
<h3 id="truehandling-the-send-action-event"><a class="anchor" href="#truehandling-the-send-action-event"></a>Handling the "Send" Action Event</h3>
<div class="paragraph">
<p>To handle the "send" event, we simply add the following inside the constructor of our form controller:</p>
</div>
<div class="listingblock java">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">addActionListener(send, evt-&gt;{
    evt.consume();
    ChatRoomView.ViewModel room = (ChatRoomView.ViewModel)evt.getEntity();
    String textFieldContents = room.getInputBuffer();
    if (textFieldContents != null &amp;&amp; !textFieldContents.isEmpty()) {
        ChatBubbleView.ViewModel message = new ChatBubbleView.ViewModel();
        message.messageText(textFieldContents);
        message.date(new Date());
        message.isOwn(true); // Indicates that this is sent by "this" user
                            // so bubble is on right side of room view.

        // Now add the message
        room.addMessages(message);

        // Clear the text field contents
        room.inputBuffer("");
    }

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>This listener will be called whenever the "send" action is fired.   On mobile devices this will only occur when the user presses the "Send" button.  But on desktop, it will also be fired when the user hits "Enter" while the text field is focused.</p>
</div>
<div class="paragraph">
<p>The event passed to this handler is an instance of <code>ActionEventNode</code> which includes all of the contextual information necessary to identify the source of the action, including the entity (the room), the UI component (the ChatRoomView) object, and the action (send), that triggered the event.</p>
</div>
<div class="paragraph">
<p>The logic in this handler should be pretty straight forward.  It checks if the "input buffer" contains any text.  Since the input buffer is bound to the text field, this is just checks if the text field contains any text.  It then creates a new message with the input buffer contents, and clears the contents of the input buffer.</p>
</div>
<div class="paragraph">
<p>All of these property changes will fire PropertyChangeEvents to the view so that the view state will be updated automatically and instantly.</p>
</div>
<div class="paragraph">
<p>If you run the app in the simulator again, you should be able to enter text into the text field, and press send, to see a new chat bubble animated into place.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-210220-025700.826.png" alt="Posting a second message">
</div>
</div>
</div>
<div class="sect2">
<h3 id="truebonus-points-disable-send-button-when-input-empty"><a class="anchor" href="#truebonus-points-disable-send-button-when-input-empty"></a>Bonus Points: Disable Send Button When Input Empty</h3>
<div class="paragraph">
<p>In out action handler, we include logic to prevent sending empty messages.  But it would be nice if we game the user a cue in the user interface that "send" doesn&#8217;t work when the field is empty.  We can do this using the <code>enabledCondition</code> attribute in our action definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode send = action(
    enabledCondition(entity-&gt; {
        return !entity.isEmpty(ChatRoom.inputBuffer);
    }),
    icon(FontImage.MATERIAL_SEND)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>This says that the <code>send</code> action should only be enabled when the "entity" is non-empty.  The "entity" in this case is the view model for the chat room.</p>
</div>
<div class="paragraph">
<p>Start the app again in the simulator and notice that the "send" button toggles between enabled and disabled depending on whether there is text in the input field.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-061950.561.png" alt="Send is disabled">
</div>
<div class="title">Figure 5. Send button is disabled because the input field is empty</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-062010.453.png" alt="Send is enabled">
</div>
<div class="title">Figure 6. Send button is enabled because the input field in non-empty</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-text-messages-from-other-users"><a class="anchor" href="#trueadding-text-messages-from-other-users"></a>Adding Text Messages from Other Users</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Our current example only includes messages that the current user posted themself.  I.e. We only have chat bubbles on the right-hand side of the view.  Let&#8217;s add some more sample data to our view model to give us a feel for how a real chat will look.  In the <code>ChatFormController</code> class, we&#8217;ll change the <code>createViewModel()</code> method as follows:</p>
</div>
<div class="listingblock">
<div class="title">Creating more interesting sample data for the ChatRoom&#8217;s view model.  We add messages from both the current user and other users.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">// Create a view model for the chat room
private Entity createViewModel() {
    ChatRoomView.ViewModel room = new ChatRoomView.ViewModel();

    // Make up some dummy times for the chat messages.
    long SECOND = 1000l;
    long MINUTE = SECOND * 60;
    long HOUR = MINUTE * 60;
    long DAY = HOUR * 24;

    // Make first message 2 days ago.
    long t = System.currentTimeMillis() - 2 * DAY;

    // Some thumbnails for the avatars of the participants
    String georgeThumb = "https://weblite.ca/cn1tests/radchat/george.jpg";
    String kramerThumb = "https://weblite.ca/cn1tests/radchat/kramer.jpg";

    room.addMessages(createDemoMessage("Why couldn't you have made me an architect? You know I always wanted to pretend that I was an architect. "
            + "Well I'm supposed to see her tomorrow, I'm gonna tell her what's goin on. Maybe she likes me for me.",
            new Date(t), "George", georgeThumb));
    t += HOUR;
    room.addMessages(createDemoMessage("Hey", new Date(t), "Kramer", kramerThumb));
    t += MINUTE;
    room.addMessages(createDemoMessage("Hey", new Date(t), null,  null));

    return room;
}

// Create a single demo message
private Entity createDemoMessage(String text,
        Date datePosted,
        String participant,
        String iconUrl) {
    ChatBubbleView.ViewModel msg = new ChatBubbleView.ViewModel();
    msg.messageText(text)
            .date(datePosted)
            .iconUrl(iconUrl)
            .isOwn(participant == null);
    if (participant != null) {
        msg.postedBy(participant);
    }
    return msg;

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>To make things easier to read, I&#8217;ve broken out the code for creating a message into a separate method so we can call create new messages more easily.  I&#8217;ve created a couple of pretend users, "George" and "Kramer", and I&#8217;ve provided some thumbnail URLs for them, which can be used as avatars in the chat room.</p>
</div>
<div class="paragraph">
<p>And the result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-063816.092.png" alt="Chat room with messages from both current user" width="and other users.">
</div>
<div class="title">Figure 7. Chat room now includes messages from two other users, George and Kramer.</div>
</div>
<div class="paragraph">
<p>Notice that it shows the time of the first chat message, but not the others.  This is intentional.  The chat room will only show the time of messages if there is a long delay between it and the previous message.  You can see the time of each message by swiping to the left:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-064242.291.png" alt="Image 220220 064242.291">
</div>
<div class="title">Figure 8. Swipe to the left to reveal the date and time of each message.</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-the-participants-title-component"><a class="anchor" href="#trueadding-the-participants-title-component"></a>Adding the "Participants" Title Component</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Recall the screenshot of the finished app, in which the form title included a list of participants in the chat room with their avatars.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-064702.972.png" alt="Image 220220 064702.972">
</div>
<div class="title">Figure 9. Participants title component with avatars.</div>
</div>
<div class="paragraph">
<p>Let&#8217;s add this now by adding some participants to the view model.   The <code>ChatRoomView.ViewModel</code> includes methods to directly add participants to the model via <code>addParticpant(Entity&#8230;&#8203; participants)</code>.  Each participant entity should implement the <code>Thing.name</code> or <code>Thing.thumbnailUrl</code> tags, or both.  If Only <code>Thing.name</code> is provided, then it will generate an avatar with the first letter of their name.  If  <code>Thing.thumbnailUrl</code> is provided, then it will use the image at this url as the avatar.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s begin by creating a custom entity/view model named "ChatAccount" which will be used as participants in the chat.  Create a new Java class named "ChatAccount" with the following contents:</p>
</div>
<div class="listingblock">
<div class="title">The ChatAccount entity will be used to encapsulate profiles for participants in the chat room.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;
import com.codename1.rad.models.Entity;
import com.codename1.rad.models.EntityType;
import static com.codename1.rad.models.EntityType.tags;
import com.codename1.rad.models.StringProperty;
import com.codename1.rad.schemas.Thing;

/**
 * View model for an account profile.
 * @author shannah
 */
public class ChatAccount extends Entity {

    // The name property
    public static StringProperty name; <i class="conum" data-value="1"></i><b>(1)</b>

    private static final EntityType TYPE = new EntityType() {{ <i class="conum" data-value="2"></i><b>(2)</b>
        name = string(tags(Thing.name)); <i class="conum" data-value="3"></i><b>(3)</b>
    }};
    {
        setEntityType(TYPE); <i class="conum" data-value="4"></i><b>(4)</b>
    }

    public ChatAccount(String nm) {
        set(name, nm);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The "name" property of our entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define an entity type for the ChatAccount entity. The entity type defines which properties are supported by the ChatAccount entity.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Generating the "name" property as a string property.  Notice that we assign the <code>Thing.name</code> tag to this property, which will allow views to bind to it.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Set the entity type inside the "instance" initializer so that all <code>ChatAccount</code> objects have the same entity type.  This could have been placed inside the constructor, but placing it simply inside the initializer (i.e. inside <code>{..}</code>) makes for a little less typing, and also helps to signify the declarative nature of this call.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>I&#8217;ve added some notes about the key lines of the code listing above which should help to get you up to speed if this is your first custom entity.  This entity defines a single property, "name".  If we were to define this entity as a POJO (Plain-Old Java object), the class might look something like:</p>
</div>
<div class="listingblock">
<div class="title">What the <code>ChatAccount</code> entity would look like if implemented as a POJO (Plain old java object).</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public class ChatAccount {
    private String name;
    public ChatAccount(String name) {
        this.name = name;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>So why not use a POJO for our entity? </strong></p>
</div>
<div class="paragraph">
<p>The <code>Entity</code> class, together with <code>EntityType</code> provide lots of useful features such as bindable properties, property change events, data conversion, observability, and reflection.  All of these features are necessary to enable the creation of loosely coupled components with clean separation between models, views, and controllers.  As you&#8217;ll see, this loose coupling greatly enhances our ability to produce complex, reusable components, which results in better apps with less code.</p>
</div>
<div class="sect2">
<h3 id="truesidebar-getting-and-setting-properties-on-entities"><a class="anchor" href="#truesidebar-getting-and-setting-properties-on-entities"></a>Sidebar: Getting and Setting Properties on Entities</h3>
<div class="paragraph">
<p>Before proceeding, its worth discussing the basics of how to <strong>use</strong> entities.  The <code>Entity</code> class allows us to get and set properties without needing to define getter and setter methods.  It also includes a rich set of convenience methods for handling data-conversion.  Finally, one of the most powerful features of entities is its loose coupling.  It is possible to get and set property values without any knowledge of which properties exist in the entity, via tags.</p>
</div>
<div class="paragraph">
<p>First things first:  Getting and setting property values.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Getting and setting property values using a direct property reference.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>ChatAccount account = new ChatAccount("George");
String name = account.get(ChatAccount.name);  // "George"
account.set(ChatAccount.name, "Kramer");
name = account.get(ChatAccount.name);  // "Kramer"</pre>
</div>
</div>
<div class="paragraph">
<p>This code is tightly coupled to the <code>ChatAccount</code> entity because it directly references the <code>ChatAccount.name</code> property.  In some cases, this tight coupling is fine.  In other cases, such as when you want to develop a reusable component that requires a "name" property, you may prefer to use "loose" coupling, as follows:</p>
</div>
<div class="listingblock">
<div class="title">Getting and Setting properties using Tags instead of Properties allows for loose coupling.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">Entity account = ...;  // Could be any entity, but happens to be a ChatAccount
account.setText(Thing.name, "George");
String name = account.getText(Thing.name); // "George"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>CodeRAD</code> library includes a hierarchy of schemas which define tags that may be used to tag entity properties.  These schemas were adapted from <a href="https://schema.org" class="bare">https://schema.org</a>, which defines entities and properties for a large number of common object types.  All schemas extend the base schema, <a href="https://schema.org/Thing">Thing</a>.   Some common tags include <code>name</code>, <code>identifier</code>, and <code>thumbnailUrl</code>.  When creating reusable components, you can use these schema "tags" to access property values of view models in loosely coupled way.  The javadocs for View components should list the tags that it expects on its view models, so you can tag the properties on your entities accordingly.
For a full list of schemas, check out <a href="https://schema.org/docs/full.html" class="bare">https://schema.org/docs/full.html</a>.  Only a subset has been ported into the CodeRAD library.  More will be added over time, and you may contribute your own with a pull request.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="truefinally-adding-the-participants"><a class="anchor" href="#truefinally-adding-the-participants"></a>Finally&#8230;&#8203; Adding the Participants</h3>
<div class="paragraph">
<p>After a lengthy discussion of Entities, Entity types, Tags, and Properties, we can now go ahead and add some participants to the chat room.  Add the following inside our <code>createViewModel()</code> method of the <code>ChatFormController</code> class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">room.addParticipants(new ChatAccount("George"), new ChatAccount("Kramer"));</code></pre>
</div>
</div>
<div class="paragraph">
<p>This adds two profiles to the chat room as participants.  Now, if we launch the app we&#8217;ll see the form title replaced with the following avatars.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-074948.423.png" alt="Image 220220 074948.423">
</div>
<div class="title">Figure 10. Title component with avatars generated from our participants</div>
</div>
<div class="paragraph">
<p>Now, let&#8217;s go a step further and add a "thumbnail url" property to our ChatAccount entity.</p>
</div>
<div class="listingblock">
<div class="title">Adding a <code>thumbnailUrl</code> property to the ChatAccount entity</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;
import com.codename1.rad.models.Entity;
import com.codename1.rad.models.EntityType;
import static com.codename1.rad.models.EntityType.tags;
import com.codename1.rad.models.StringProperty;
import com.codename1.rad.schemas.Thing;

/**
 * View model for an account profile.
 * @author shannah
 */
public class ChatAccount extends Entity {

    // The name property
    public static StringProperty name, thumbnailUrl;

    private static final EntityType TYPE = new EntityType() {{
        name = string(tags(Thing.name));
        thumbnailUrl = string(tags(Thing.thumbnailUrl));
    }};
    {
        setEntityType(TYPE);
    }

    public ChatAccount(String nm, String thumb) {
        set(name, nm);
        set(thumbnailUrl, thumb);
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And modify our ChatFormController to set the thumbnail URL on our entity.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">room.addParticipants(
    new ChatAccount("George", georgeThumb),
    new ChatAccount("Kramer", kramerThumb)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>And reload&#8230;&#8203;</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-075435.679.png" alt="Image 220220 075435.679">
</div>
<div class="title">Figure 11. Title component after setting thumbnail URLs for our participants.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-more-actions"><a class="anchor" href="#trueadding-more-actions"></a>Adding More Actions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far we&#8217;ve implemented the basic requirements of a chat room.  It can display messages, show particpants, and it allows users to send new messages.  Now let&#8217;s go a step further and add some more actions.  CodeRAD views like ChatRoomView allow for customization in a variety of ways, but the two primary methods are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Actions</p>
</li>
<li>
<p>View properties</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>We&#8217;ve already used one action to implement the "send" function.  As a reminder, we defined the action in our controller, then we passed it as an attribute to the <code>ViewNode</code> when creating the view:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode send = action( <i class="conum" data-value="1"></i><b>(1)</b>
    enabledCondition(entity-&gt; {
        return !entity.isEmpty(ChatRoom.inputBuffer);
    }),
    icon(FontImage.MATERIAL_SEND)
);
....
ViewNode viewNode = new ViewNode(
    actions(ChatRoomView.SEND_ACTION, send) <i class="conum" data-value="2"></i><b>(2)</b>
);
....
ChatRoomView view = new ChatRoomView(createViewModel(), viewNode, f); <i class="conum" data-value="3"></i><b>(3)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Defining the "send" action.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Adding the "send" action to the view node, under the <code>ChatRoomView.SEND_ACTION</code> category.  The category is a hint to the view about where and how the action should be incorporated into the View.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Creating new ChatRoomView, passing our ViewNode as a parameter</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A <code>ViewNode</code> is a user interface descriptor that can be used to customize the behaviour of a View.  It provides a declarative way to define complex user interfaces in a simple way.  For the purpose of this tutorial, we will only use the node as a means to pass actions to the ChatRoomView.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The "Send" action was added to the <code>ChatRoomView.SEND_ACTION</code> category, but the ChatRoomView also supports some other categories:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_CLICKED</code> - An action that will be "fired" when the user clicks a chat bubble.</p>
</li>
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_LONG_PRESS</code> - An action that will be "fired" when the user long presses a chat bubble.</p>
</li>
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_CLICKED_MENU</code> - Actions that will be displayed in a popup-menu when the user clicks on a chat bubble.  This category many include more than one action, and all of supplied actions will be included as menu items in the menu.</p>
</li>
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_CLICKED_MENU</code> - Actions that will be displayed in a popup-menu when the user long presses on a chat bubble.</p>
</li>
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_LONG_PRESS_MENU</code> - Actions that will be displayed in a popup-menu when the chat bubble is long pressed.</p>
</li>
<li>
<p><code>ChatBubbleView.CHAT_BUBBLE_BADGES</code> - Actions in this category will be rendered as "badge" icons next to the chat bubble.  This is useful, for example, for displaying a "Like/Heart" badge on a chat bubble.</p>
</li>
<li>
<p><code>ProfileAvatarView.PROFILE_AVATAR_CLICKED</code> - An action that will be "fired" when the user clicks on one of the profile avatars next to a chat bubble, or in the title component.</p>
</li>
<li>
<p><code>ProfileAvatarView.PROFILE_AVATAR_LONG_PRESS</code> - An action that will be "fired" when the user long presses on one of the profile avatars.</p>
</li>
<li>
<p><code>ProfileAvatarView.PROFILE_AVATAR_CLICKED_MENU</code> - Actions in this category will be rendered in a popup menu when the user clicks on an avatar.</p>
</li>
<li>
<p><code>ProfileAvatarView.PROFILE_AVATAR_LONG_PRESS_MENU</code> - Actions in this category will be rendered in a popup menu when the user long presses on an avatar.</p>
</li>
<li>
<p><code>ChatRoomView.TEXT_ACTIONS</code> - Actions in this category will be rendered as buttons next to the text input field.  This is an appropriate place to add "Photo" or "Video" capture capabilities.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="trueadding-phone-and-video-conferencing"><a class="anchor" href="#trueadding-phone-and-video-conferencing"></a>Adding Phone and Video Conferencing</h3>
<div class="paragraph">
<p>To get our feet wet with actions, let&#8217;s add some options to initiate a phone-call or video conference with one of the participants.  When the user taps on a profile&#8217;s avatar, we&#8217;ll present the user with a menu to start a call or video conference.</p>
</div>
<div class="paragraph">
<p>In the ChatFormController, we&#8217;ll add a couple of new actions.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode phone = action(
    icon(FontImage.MATERIAL_PHONE)
);

public static final ActionNode videoConference = action(
    icon(FontImage.MATERIAL_VIDEOCAM)
);

...

ViewNode viewNode = new ViewNode(
    actions(ChatRoomView.SEND_ACTION, send),
    actions(ProfileAvatarView.PROFILE_AVATAR_CLICKED_MENU, phone, videoConference) <i class="conum" data-value="1"></i><b>(1)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We add the <code>phone</code> and <code>videoConference</code> actions to the ViewNode in the <code>ProfileAvatarView.PROFILE_AVATAR_CLICKED_MENU</code> category so that they&#8217;ll be rendered in a popup-menu when the user presses on an avatar.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now run the app and click on the title component:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-084136.625.png" alt="Image 220220 084136.625">
</div>
<div class="title">Figure 12. Menu when clicking on the title component</div>
</div>
<div class="paragraph">
<p>Or tap on an avatar next to one of the chat bubbles:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-084244.673.png" alt="Image 220220 084244.673">
</div>
<div class="title">Figure 13. Pop-up menu when tapping on an avatar</div>
</div>
<div class="paragraph">
<p>Currently, clicking on the "phone" or "camera" icon doesn&#8217;t do anything because we haven&#8217;t defined a handler.  Let&#8217;s do that now:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">addActionListener(phone, evt-&gt;{
    evt.consume();
    if (!CN.canDial()) {
        Dialog.show("Not supported", "Phone calls not supported on this device", "OK", null);
        return;
    }
    if (evt.getEntity().isEmpty(Person.telephone)) {
        Dialog.show("No Phone", "This user has no phone number", "OK", null);
        return;
    }

    String phoneNumber = evt.getEntity().getText(Person.telephone);
    CN.dial(phoneNumber);

});</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this handler we first check to see if the platform supports phone calls, and fail with a dialog if it doesn&#8217;t.  Then we check if the entity in question has a phone number.  This code makes use of loose-coupling as we using the <code>Person.telephone</code> tag to check for a phone number rather than a particular property.  This will allow this code to work with any entity that has such a property. We also make use of the handy <code>Entity.isEmpty(Tag)</code> method, which will return true if this entity doesn&#8217;t have a matching property, or if the entity has the property, but has an "empty" value for it.</p>
</div>
<div class="paragraph">
<p>If you try the app out and attempt to phone any of the users, you&#8217;ll receive this dialog:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-085620.325.png" alt="Image 220220 085620.325">
</div>
<div class="title">Figure 14. Currently our ChatAccount entity doesn&#8217;t include any properties with the <code>Person.telephone</code> tag, so attempting to phone a user will yield this error dialog.</div>
</div>
<div class="paragraph">
<p>Let&#8217;s remedy this situation by adding a property to the ChatAccount entity type.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">package com.codename1.cn1chat;
import com.codename1.rad.models.Entity;
import com.codename1.rad.models.EntityType;
import static com.codename1.rad.models.EntityType.tags;
import com.codename1.rad.models.StringProperty;
import com.codename1.rad.schemas.Person;
import com.codename1.rad.schemas.Thing;

/**
 * View model for an account profile.
 * @author shannah
 */
public class ChatAccount extends Entity {

    // The name property
    public static StringProperty name, thumbnailUrl, phone;

    private static final EntityType TYPE = new EntityType() {{
        name = string(tags(Thing.name));
        thumbnailUrl = string(tags(Thing.thumbnailUrl));
        phone = string(tags(Person.telephone)); <i class="conum" data-value="1"></i><b>(1)</b>
    }};
    {
        setEntityType(TYPE);
    }

    public ChatAccount(String nm, String thumb, String phoneNum) {
        set(name, nm);
        set(thumbnailUrl, thumb);
        set(phone, phoneNum);
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Creating the phone property as a string property with the <code>Person.telephone</code> tag.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And we&#8217;ll update the code in our ChatFormController that creates our participants to add a phone number.</p>
</div>
<div class="listingblock">
<div class="title">Adding a phone number to the George account in the view controller.  We leave Kramer&#8217;s phone number null.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">room.addParticipants(
    new ChatAccount("George", georgeThumb, "712-555-1234"),
    new ChatAccount("Kramer", kramerThumb, null)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Let&#8217;s start up the app again.  There are a few things to notice here:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>If you press on either George or Kramer&#8217;s avatar next to one of their chat bubbles, and try to phone them, they&#8217;ll both give you the "This user has no phone number" message.  Thats because the avatar that appears next to the chat bubble is actually the ChatMessage.ViewModel entity, and not our ChatAccount entity.  The ChatMessage.ViewModel entity doesn&#8217;t include a telephone field.  The ChatAccount entities are only used to render the title component of the form.</p>
</li>
<li>
<p>If you try to phone Kramer via the title component, you&#8217;ll get the same "This user has no phone number" message.  This is correct, because we didn&#8217;t give Kramer a phone number.</p>
</li>
<li>
<p>If you try to phone George via the title component, it will dial the number that we registered with the George account.  (If you&#8217;re running in the simulator, it won&#8217;t dial&#8230;&#8203; it will just display a message in the console indicating that it is dialing the number).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>This is progress, but why don&#8217;t we save the user the agony of having to click "phone" to find out if the app can actually make a phone call to that user.  We have two options for this, we can either "disable" the phone action conditionally, like we did for the "send" action when the input field is empty.  This will still show the phone button in the menu, but it will be greyed out and disabled.  Alternatively we could actually remove the phone action in such cases so that it isn&#8217;t displayed at all for entities that don&#8217;t support it.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s try it both ways:</p>
</div>
<div class="listingblock">
<div class="title">Disabling the phone action for entities that don&#8217;t have a phone number</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode phone = action(
    icon(FontImage.MATERIAL_PHONE),
    enabledCondition(entity-&gt;{
        return CN.canDial() &amp;&amp; !entity.isEmpty(Person.telephone);
    })
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>Result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-091214.259.png" alt="Image 220220 091214.259">
</div>
<div class="title">Figure 15. Kramer&#8217;s phone button is disabled because we didn&#8217;t provide a phone number for him.</div>
</div>
<div class="paragraph">
<p>If we want to remove the action from menus where it isn&#8217;t supported, then we simply change <code>enabledCondition()</code> to <code>condition()</code>.</p>
</div>
<div class="listingblock">
<div class="title">Removing the phone action for entities that don&#8217;t have a phone number.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode phone = action(
    icon(FontImage.MATERIAL_PHONE),
    condition(entity-&gt;{ <i class="conum" data-value="1"></i><b>(1)</b>
        return CN.canDial() &amp;&amp; !entity.isEmpty(Person.telephone);
    })
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We use the <code>condition(&#8230;&#8203;)</code> attribute instead of <code>enabledCondition(&#8230;&#8203;)</code> to disable/hide the action</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And the result:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-091549.549.png" alt="Image 220220 091549.549">
</div>
<div class="title">Figure 16. Kramer has no "phone" option now because he doesn&#8217;t have a phone number.</div>
</div>
</div>
<div class="sect2">
<h3 id="trueadding-a-like-badge"><a class="anchor" href="#trueadding-a-like-badge"></a>Adding a "Like" Badge</h3>
<div class="paragraph">
<p>Most messaging apps provide a way to "like" a chat message.  Let&#8217;s add this functionality to our app by using the <code>ChatBubbleView.CHAT_BUBBLE_BADGES</code> category to display the "liked" badge.  We&#8217;ll use the <code>ChatBubbleView.CHAT_BUBBLE_LONG_PRESS_MENU</code> category to display the toggle button for the user to "like" and "unlike" the message.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode likedBadge = UI.action(
    UI.uiid("ChatBubbleLikedBadge"), <i class="conum" data-value="1"></i><b>(1)</b>
    icon(FontImage.MATERIAL_FAVORITE),
    condition(entity-&gt;{ <i class="conum" data-value="2"></i><b>(2)</b>
        return !entity.isFalsey(ChatMessage.isFavorite); <i class="conum" data-value="3"></i><b>(3)</b>
    })

);

public static final ActionNode likeAction = UI.action(
    icon(FontImage.MATERIAL_FAVORITE_OUTLINE),
    uiid("LikeButton"), <i class="conum" data-value="4"></i><b>(4)</b>
    selected(icon(FontImage.MATERIAL_FAVORITE)), <i class="conum" data-value="5"></i><b>(5)</b>
    selectedCondition(entity-&gt;{
        return !entity.isFalsey(ChatMessage.isFavorite); <i class="conum" data-value="6"></i><b>(6)</b>
    })

);

...

ViewNode viewNode = new ViewNode(
    actions(ChatRoomView.SEND_ACTION, send),
    actions(ProfileAvatarView.PROFILE_AVATAR_CLICKED_MENU, phone, videoConference),
    actions(ChatBubbleView.CHAT_BUBBLE_LONG_PRESS_MENU, likeAction), <i class="conum" data-value="7"></i><b>(7)</b>
    actions(ChatBubbleView.CHAT_BUBBLE_BADGES, likedBadge) <i class="conum" data-value="8"></i><b>(8)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We set the UIID of the badge to "ChatBubbleLikedBadge" which is a style defined in the RADChatRoom cn1lib&#8217;s stylesheet.  It will make the badge small and red.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Use the <code>condition()</code> attribute to ensure that the "liked" badge only shows up if the message has been liked.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We are using the convenience method <code>Entity.isFalsey(Tag)</code> to determine if the chat message has been liked.  This returns "true" if the value of this field is anything "falsey", like <code>null</code>, or <code>""</code>, or <code>0</code>, or <code>false</code>.  This allows for flexibility about how the view model wants to store whether the message is a favourite or not.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>We define a UIID for the "Like" action so that we can make the button look how we like.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>We use the <code>selected(&#8230;&#8203;)</code> attribute on the <code>likeAction</code> to define a different icon for the action when the action is "selected".</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We use <code>selectedCondition()</code> on the like action to cause the action to be selected conditionally on whether the message is "liked".  This works similar to the <code>condition()</code> and <code>enabledCondition()</code> attributes, except this will affect the selected state of the action&#8217;s button.  The presence of this attribute causes the button to be rendered as a toggle button instead of a regular button.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>We add the like action to the <code>CHAT_BUBBLE_LONG_PRESS_MENU</code> category.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>We add the liked action to the <code>CHAT_BUBBLE_BADGES</code> category.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And, of course, we need to handle the "like" action to toggle the property on and off in the view model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">addActionListener(likeAction, evt-&gt;{
    evt.consume(); <i class="conum" data-value="1"></i><b>(1)</b>
    Entity chatMessage = evt.getEntity();
    chatMessage.setBoolean( <i class="conum" data-value="2"></i><b>(2)</b>
            ChatMessage.isFavorite, <i class="conum" data-value="3"></i><b>(3)</b>
            chatMessage.isFalsey(ChatMessage.isFavorite) <i class="conum" data-value="4"></i><b>(4)</b>
    );

});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We consume the event so that the view knows that we handled it.  This prevents any default behaviour from conflicting.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>We use the <code>Entity.setBoolean(&#8230;&#8203;)</code> method to signify that we are setting the value as a boolean.  This will ensure that the value is converted to the correct type for the underlying property.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>We use the <code>ChatMessage.isFavorite</code> tag to target the field for loose coupling.  The <code>ChatBubbleView.ViewModel</code> class that we&#8217;re using does implement a property with this tag, but we are writing code in such a way that we don&#8217;t need to care about which property it is.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Again using <code>isFalsey()</code> to get the current value of the flag, and we toggle it to be opposite.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, our "Like" button will be a heart icon.  When selected it will be a filled heart icon.  When unselected, it will be contour of a heart.  We specified a UIID of "LikeButton" for this action in its definition.  We just need to add this style to our stylesheet.  Open the project&#8217;s stylesheet (at css/theme.css) and add the following:</p>
</div>
<div class="listingblock">
<div class="title">The style for the Like button, which we add the the project&#8217;s stylesheet.</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="css" class="language-css hljs">LikeButton {
    background-color:transparent;
    cn1-border-type: none;
    color: red;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>And the test drive&#8230;&#8203;  Open up the app again, long press on a chat message, and click the "Like" action.  Then it should display a red heart badge next to the chat bubble.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-230220-090032.786.png" alt="Image 230220 090032.786">
</div>
<div class="title">Figure 17. Menu appears when you long-press on a chat bubble.  Clicking on the button will fire the "Like" action.</div>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-220220-094646.764.png" alt="Image 220220 094646.764">
</div>
<div class="title">Figure 18. After we "like" George&#8217;s message, it displays the "liked" badge.</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-a-photo-capture-feature"><a class="anchor" href="#trueadding-a-photo-capture-feature"></a>Adding A Photo Capture Feature</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most messaging applications include the ability to add photos to messages.  Let&#8217;s add this feature to our chat app now.</p>
</div>
<div class="paragraph">
<p>First we&#8217;ll define a new action called "capturePhoto", and add to the the <code>TEXT_ACTIONS</code> category of our view node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">public static final ActionNode capturePhoto = action(
        icon(FontImage.MATERIAL_CAMERA)
);

...

ViewNode viewNode = new ViewNode(
    actions(ChatRoomView.SEND_ACTION, send),
    actions(ProfileAvatarView.PROFILE_AVATAR_CLICKED_MENU, phone, videoConference),
    actions(ChatBubbleView.CHAT_BUBBLE_LONG_PRESS_MENU, likeAction),
    actions(ChatBubbleView.CHAT_BUBBLE_BADGES, likedBadge),
    actions(ChatRoomView.TEXT_ACTIONS, capturePhoto) <i class="conum" data-value="1"></i><b>(1)</b>
);</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Added capturePhoto action to the TEXT_ACTIONS category so that it will appear as a button beside the text field.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>And we&#8217;ll also add a handler for this action, which will capture a photo, and emed the photo in a message that we will add to the chat room&#8217;s view model.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="java" class="language-java hljs">addActionListener(capturePhoto, evt-&gt;{
    evt.consume();
    String photoPath = Capture.capturePhoto();
    if (photoPath == null) {
        // User canceled the photo capture
        return;
    }


    File photos = new File("photos"); <i class="conum" data-value="1"></i><b>(1)</b>
    photos.mkdirs();
    Entity entity = evt.getEntity();
    File photo = new File(photos, System.currentTimeMillis()+".png");
    try (InputStream input = FileSystemStorage.getInstance().openInputStream(photoPath);
            OutputStream output = FileSystemStorage.getInstance().openOutputStream(photo.getAbsolutePath())) {
        Util.copy(input, output);

        ChatBubbleView.ViewModel message = new ChatBubbleView.ViewModel();
        message.attachmentImageUrl(photo.getAbsolutePath()); <i class="conum" data-value="2"></i><b>(2)</b>
        message.isOwn(true);
        message.date(new Date());
        EntityList messages = entity.getEntityList(ChatRoom.messages); <i class="conum" data-value="3"></i><b>(3)</b>
        if (messages == null) {
            throw new IllegalStateException("This chat room has no messages list set up");
        }
        messages.add(message); <i class="conum" data-value="4"></i><b>(4)</b>

    } catch (IOException ex) {
        Log.e(ex);
        ToastBar.showErrorMessage(ex.getMessage());
    }
});</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We will create a directory named "photos" where we store all of the photos for the app.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the path of this photo under <code>attachmentImageUrl</code>.  The ChatBubbleView will accept http, https, and file URLs, as well as storage keys.  It will render them correctly in the view according to the type of URL it is.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The "entity" of this event is the view model for the ChatRoomView.  Here we use the <code>ChatRoom.messages</code> tag to access the messages list in a loosely coupled way.  This code will work even if we change the class that we use for the ChatRoomView&#8217;s view model.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Adding the message to the <code>messages</code> entity list will trigger a list change event and it will be rendered automatically in the chat room.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now, let&#8217;s fire the chat up again and take it for a test drive.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-230220-010814.955.png" alt="Image 230220 010814.955">
</div>
<div class="title">Figure 19. The <code>capturePhoto</code> action is rendered as a button beside the input text field.</div>
</div>
<div class="paragraph">
<p>You should now be able to click on the "capture photo" button to capture an image.  In the simulator, it will open a file dialog to select an image.  On device, it will activate the devices camera so that you can take a photo.  After capturing an image, it should be added to the chat inside a message bubble as shown below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/Image-230220-011106.570.png" alt="Image 230220 011106.570">
</div>
<div class="title">Figure 20. Photo appears in chat after capture.</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-02-23 13:12:53 -0800
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>